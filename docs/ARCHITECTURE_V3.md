# Miaoda V3 架构设计

## 核心理念
将应用程序拆分为独立的模块，每个模块负责特定功能，模块间通过清晰的接口通信。

## 模块划分

### 1. 环境检测模块 (Environment Module)
- **位置**: 独立的窗口/面板
- **功能**: 
  - 实时检测系统环境
  - 显示各依赖状态
  - 提供快速修复建议
- **不包含**: 安装功能、终端输出

### 2. 依赖安装模块 (Installer Module)  
- **位置**: 独立的安装向导界面
- **功能**:
  - 一键安装所有依赖
  - 显示安装进度
  - 提供手动安装指南
- **不包含**: 环境检测、终端命令

### 3. 配置管理模块 (Config Module)
- **位置**: 独立的配置面板
- **功能**:
  - 创建/编辑/删除配置
  - 切换当前配置
  - 导入/导出配置
- **不包含**: 终端输出、安装功能

### 4. 终端模块 (Terminal Module)
- **位置**: 主界面终端区域
- **功能**:
  - 仅显示 Claude 执行输出
  - 接收用户输入并传递给 Claude
  - 清晰的输出格式
- **不包含**: 系统命令、安装日志、配置信息

### 5. 主控制模块 (Main Controller)
- **功能**:
  - 协调各模块工作
  - 管理模块间通信
  - 处理全局状态

## 用户界面布局

```
┌─────────────────────────────────────────────┐
│  Miaoda - Claude Code Manager               │
├─────────────────────────────────────────────┤
│ ┌───────────┐ ┌─────────────────────────┐  │
│ │           │ │                         │  │
│ │  侧边栏    │ │      主内容区域          │  │
│ │           │ │                         │  │
│ │ - 环境状态 │ │   终端 (Claude 输出)     │  │
│ │ - 配置列表 │ │                         │  │
│ │ - 快捷操作 │ │                         │  │
│ │           │ │                         │  │
│ └───────────┘ └─────────────────────────┘  │
│ ┌─────────────────────────────────────────┐ │
│ │          状态栏                         │ │
│ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────┘
```

## 数据流

1. **启动流程**:
   - 主程序启动 → 环境检测 → 显示主界面
   - 如果环境不完整 → 提示用户打开安装向导

2. **配置切换**:
   - 用户选择配置 → 更新全局状态 → 通知终端模块

3. **Claude 启动**:
   - 检查环境 → 加载配置 → 启动 Claude → 终端显示输出

## 技术实现

### 主进程 (Main Process)
- `environment-service.js` - 环境检测服务
- `installer-service.js` - 安装服务
- `config-service.js` - 配置管理服务
- `claude-service.js` - Claude 进程管理
- `ipc-controller.js` - IPC 通信控制

### 渲染进程 (Renderer Process)
- `components/EnvironmentPanel.js` - 环境面板
- `components/InstallerWizard.js` - 安装向导
- `components/ConfigManager.js` - 配置管理器
- `components/Terminal.js` - 终端组件
- `components/Sidebar.js` - 侧边栏
- `App.js` - 主应用组件

### 通信协议
使用事件驱动的 IPC 通信：
- `env:check` - 请求环境检测
- `env:status` - 环境状态更新
- `install:start` - 开始安装
- `install:progress` - 安装进度
- `config:switch` - 切换配置
- `claude:start` - 启动 Claude
- `claude:output` - Claude 输出